<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Largest Triangle 3 Buckets</title>
    <meta name="description" content="A collection of components that make it easy to build interactive charts with D3.">

    <script src="https://d3fc.io/scripts.js"></script>

    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-96x96.png" sizes="96x96">
    <link rel="stylesheet" href="https://d3fc.io/styles.css" />
    <link rel="canonical" href="https://d3fc.io/components/sampler/largestTriangleThreeBucket.html" />
  </head>
  <body>
    <div class="content">

      <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
              <a href="https://d3fc.io/"><img class="navbar-logo" alt="d3fc" src="https://d3fc.io/images/logo.svg" /></a>
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li class=""><a href="https://d3fc.io/components/introduction/getting-started.html">Documentation</a></li>
                <li class="active"><a href="https://d3fc.io/components/chart/cartesian.html">Components</a></li>
                <li class=""><a href="https://d3fc.io/components/series/candlestick.html">Financial</a></li>
                <li class=""><a href="https://d3fc.io/examples">Examples</a></li>
                <li><a href="https://github.com/ScottLogic/d3fc">GitHub</a></li>
              </ul>
            </div>
        </div>
      </nav>

      <div class="container component">
  <div class="row">

    <div class="col-sm-9 col-xs-12">
      <h1>
        Largest Triangle 3 Buckets
        <a class="btn btn-default" href="https://github.com/ScottLogic/d3fc/blob/master/src/data/sampler/largestTriangleThreeBucket.js">View source</a>
      </h1>
      <p>Largest Triangle is a sampler where, given two pre-determined points, the point in the bucket that forms the largest triangle has the largest effective area and so is the most important in the bucket. The three bucket implementation is where the two predetermined points are chosen from the buckets before and after the bucket being evaluated. The first point is the point chosen to represent the bucket before the current bucket. The second is a &quot;ghost point&quot; representing the next bucket, which is simply an average of the x and y values of that bucket.</p>
<div class="text-center">
    <img src="largestTriangleThree.png" alt="Representation of the Largest Triangle Three Bucket algorithm">

    <p>
        Image from <a href="http://skemman.is/stream/get/1946/15343/37285/3/SS_MSthesis.pdf">Downsampling Time Series for
        Visual Representation
        </a>
    </p>
</div>

<p>The sampler requires both the <code>x</code> and <code>y</code> properties in order to calculate the area. You can configure the sampling frequency by setting the <code>bucketSize</code> property. As the Largest Triangle Three Bucket sampler computes areas, if you have a non-linear or discontinuous scale, the values supplied to the sampler must be scaled accordingly. You can apply the respective scales in the accessor functions as follows:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> sampler = fc.data.sampler.largestTriangleThreeBucket()
    .bucketSize(<span class="hljs-number">20</span>)
    .x(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> xScale(d.date); })
    .y(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(d)</span> </span>{ <span class="hljs-keyword">return</span> yScale(d.low); });
</code></pre>
<p>The example below creates an array of 1,000 datapoints, sampling it using a bucket-size of 20:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> width = <span class="hljs-number">500</span>, height = <span class="hljs-number">250</span>;
<span class="hljs-keyword">var</span> container = d3.select(<span class="hljs-string">'#largest'</span>)
    .append(<span class="hljs-string">'svg'</span>)
    .attr({<span class="hljs-string">'width'</span>: width, <span class="hljs-string">'height'</span>: height});

<span class="hljs-comment">// create a large amount of data</span>
<span class="hljs-keyword">var</span> dataGenerator = fc.data.random.financial()
    .startDate(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">2014</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
<span class="hljs-keyword">var</span> data = dataGenerator(<span class="hljs-number">1000</span>);

<span class="hljs-comment">// configure the sampler</span>
<span class="hljs-keyword">var</span> sampler = fc.data.sampler.largestTriangleThreeBucket()
    .bucketSize(<span class="hljs-number">20</span>)
    .x(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.date; })
    .y(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.low; });

<span class="hljs-comment">// sample the data</span>
<span class="hljs-keyword">var</span> sampledData = sampler(data);

<span class="hljs-keyword">var</span> xScale = fc.scale.dateTime()
    .domain(fc.util.extent().fields(<span class="hljs-string">'date'</span>)(sampledData))
    .range([<span class="hljs-number">0</span>, width]);

<span class="hljs-keyword">var</span> yScale = d3.scale.linear()
    .domain(fc.util.extent().fields(<span class="hljs-string">'low'</span>)(sampledData))
    .range([height, <span class="hljs-number">0</span>]);


<span class="hljs-comment">// render the sampled data</span>
<span class="hljs-keyword">var</span> sampledLine = fc.series.line()
    .xScale(xScale)
    .yScale(yScale)
    .yValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.low; });

container.append(<span class="hljs-string">'g'</span>)
    .datum(sampledData)
    .call(sampledLine);

<span class="hljs-comment">// render the original data</span>
<span class="hljs-keyword">var</span> originalLine = fc.series.line()
    .xScale(xScale)
    .yScale(yScale)
    .yValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.low; })
    .decorate(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">selection</span>) </span>{
        selection.enter().style(<span class="hljs-string">'stroke-opacity'</span>, <span class="hljs-string">'0.5'</span>);
    });

container.append(<span class="hljs-string">'g'</span>)
    .datum(data)
    .call(originalLine);
</code></pre>
<p>Which gives the following:</p>
<div class="codepen-link">
  <form action="https://codepen.io/pen/define" method="POST" target="_blank">
    <input type="text" name="data" hidden="true"
      value='{
        "html":"&lt;div id&#x3D;\&quot;largest\&quot; class&#x3D;\&quot;chart\&quot;&gt;&lt;/div&gt;\n",
        "js": "var width = 500, height = 250;\nvar container = d3.select(\"#largest\")\n    .append(\"svg\")\n    .attr({\"width\": width, \"height\": height});\n\n// create a large amount of data\nvar dataGenerator = fc.data.random.financial()\n    .startDate(new Date(2014, 1, 1));\nvar data = dataGenerator(1000);\n\n// configure the sampler\nvar sampler = fc.data.sampler.largestTriangleThreeBucket()\n    .bucketSize(20)\n    .x(function(d) { return d.date; })\n    .y(function(d) { return d.low; });\n\n// sample the data\nvar sampledData = sampler(data);\n\nvar xScale = fc.scale.dateTime()\n    .domain(fc.util.extent().fields(\"date\")(sampledData))\n    .range([0, width]);\n\nvar yScale = d3.scale.linear()\n    .domain(fc.util.extent().fields(\"low\")(sampledData))\n    .range([height, 0]);\n\n\n// render the sampled data\nvar sampledLine = fc.series.line()\n    .xScale(xScale)\n    .yScale(yScale)\n    .yValue(function(d) { return d.low; });\n\ncontainer.append(\"g\")\n    .datum(sampledData)\n    .call(sampledLine);\n\n// render the original data\nvar originalLine = fc.series.line()\n    .xScale(xScale)\n    .yScale(yScale)\n    .yValue(function(d) { return d.low; })\n    .decorate(function(selection) {\n        selection.enter().style(\"stroke-opacity\", \"0.5\");\n    });\n\ncontainer.append(\"g\")\n    .datum(data)\n    .call(originalLine);\n",
        "css": ".chart {\n    margin: 10px 0;\n    width: 100%;\n    height: 250px;\n}\n\n.chart&gt;svg {\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.chart.large {\n    height: 400px;\n}\n",
        "js_external": "https://d3fc.io/d3fc.bundle.js",
        "css_external": "https://d3fc.io/d3fc.css"}
      '/>
    <input type="submit" class="btn btn-default" value="Codepen"/>
  </form>
</div>


<div id='largest' class='chart'></div>

<script type="text/javascript">
var width = 500, height = 250;
var container = d3.select('#largest')
    .append('svg')
    .attr({'width': width, 'height': height});

// create a large amount of data
var dataGenerator = fc.data.random.financial()
    .startDate(new Date(2014, 1, 1));
var data = dataGenerator(1000);

// configure the sampler
var sampler = fc.data.sampler.largestTriangleThreeBucket()
    .bucketSize(20)
    .x(function(d) { return d.date; })
    .y(function(d) { return d.low; });

// sample the data
var sampledData = sampler(data);

var xScale = fc.scale.dateTime()
    .domain(fc.util.extent().fields('date')(sampledData))
    .range([0, width]);

var yScale = d3.scale.linear()
    .domain(fc.util.extent().fields('low')(sampledData))
    .range([height, 0]);


// render the sampled data
var sampledLine = fc.series.line()
    .xScale(xScale)
    .yScale(yScale)
    .yValue(function(d) { return d.low; });

container.append('g')
    .datum(sampledData)
    .call(sampledLine);

// render the original data
var originalLine = fc.series.line()
    .xScale(xScale)
    .yScale(yScale)
    .yValue(function(d) { return d.low; })
    .decorate(function(selection) {
        selection.enter().style('stroke-opacity', '0.5');
    });

container.append('g')
    .datum(data)
    .call(originalLine);

</script>


      <nav class="visible-xs-block">
        <ul class="pager">
            <li class="previous"><a href="/components/sampler/largestTriangleOne.html"><span aria-hidden="true">&larr;</span> Largest Triangle 1 Bucket</a></li>
            <li class="next"><a href="/components/sampler/modeMedian.html">Mode Median <span aria-hidden="true">&rarr;</span></a></li>
        </ul>
      </nav>
    </div>

    <nav class="col-sm-3 hidden-xs">
      <ul class="nav nav-stacked fixed nav-sidebar">
          <li>
            <h4>Chart</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/chart/cartesian.html">
                    Cartesian
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/legend.html">
                    Legend
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/small-multiples.html">
                    Small Multiples
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/sparkline.html">
                    Sparkline
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/tooltip.html">
                    Tooltip
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Series</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/series/area.html">
                    Area Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/bar.html">
                    Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/boxPlot.html">
                    Box Plot Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/cycle.html">
                    Cycle Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/errorBar.html">
                    Error Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/grouped-bar.html">
                    Grouped Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/line.html">
                    Line Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/multi.html">
                    Multi Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/point.html">
                    Point Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/stacked.html">
                    Stacked Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/waterfall.html">
                    Waterfall Series
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Annotation</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/annotation/band.html">
                    Band
                  </a>
                </li>
                <li class="">
                  <a href="/components/annotation/gridlines.html">
                    Gridlines
                  </a>
                </li>
                <li class="">
                  <a href="/components/annotation/line.html">
                    Line
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Data</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/data/spread.html">
                    Spread
                  </a>
                </li>
                <li class="">
                  <a href="/components/data/walk.html">
                    Random Walk
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Layout</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/layout/flexbox.html">
                    Flexbox
                  </a>
                </li>
                <li class="">
                  <a href="/components/layout/rectangles.html">
                    Rectangles
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Samplers</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/sampler/largestTriangleOne.html">
                    Largest Triangle 1 Bucket
                  </a>
                </li>
                <li class="active">
                  <a href="/components/sampler/largestTriangleThreeBucket.html">
                    Largest Triangle 3 Buckets
                  </a>
                </li>
                <li class="">
                  <a href="/components/sampler/modeMedian.html">
                    Mode Median
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Scale</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/scale/dateTime.html">
                    Date Time Scale
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>SVG</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/svg/axis.html">
                    Axis
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Tool</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/tool/container.html">
                    Container
                  </a>
                </li>
                <li class="">
                  <a href="/components/tool/crosshair.html">
                    Crosshair
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Util</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/util/extent.html">
                    Extent
                  </a>
                </li>
            </ul>
          </li>
      </ul>
    </nav>

  </div>
</div>


    </div>
    <footer>
      <div class="container">
        <p class="muted credit text-center">Project supported by <a href="http://www.scottlogic.com">Scott Logic</a>.</p>
        <p class="muted credit text-center">Browser testing provided by <a class="browserstack" href="https://browserstack.com">BrowserStack</a>.</p>
      </div>
    </footer>

  </body>
</html>
