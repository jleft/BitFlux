<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Rectangles</title>
    <meta name="description" content="A collection of components that make it easy to build interactive charts with D3.">

    <script src="https://d3fc.io/scripts.js"></script>

    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://d3fc.io/images/favicon-96x96.png" sizes="96x96">
    <link rel="stylesheet" href="https://d3fc.io/styles.css" />
    <link rel="canonical" href="https://d3fc.io/components/layout/rectangles.html" />
  </head>
  <body>
    <div class="content">

      <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
              <a href="https://d3fc.io/"><img class="navbar-logo" alt="d3fc" src="https://d3fc.io/images/logo.svg" /></a>
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav navbar-right">
                <li class=""><a href="https://d3fc.io/components/introduction/getting-started.html">Documentation</a></li>
                <li class="active"><a href="https://d3fc.io/components/chart/cartesian.html">Components</a></li>
                <li class=""><a href="https://d3fc.io/components/series/candlestick.html">Financial</a></li>
                <li class=""><a href="https://d3fc.io/examples">Examples</a></li>
                <li><a href="https://github.com/ScottLogic/d3fc">GitHub</a></li>
              </ul>
            </div>
        </div>
      </nav>

      <div class="container component">
  <div class="row">

    <div class="col-sm-9 col-xs-12">
      <h1>
        Rectangles
        <a class="btn btn-default" href="https://github.com/ScottLogic/d3fc/blob/master/src/layout/rectangles.js">View source</a>
      </h1>
      <p>The rectangles layout component provides a mechanism for arranging child components based on their rectangular bounding boxes. It is typically used to render tooltips or labels on a chart, but can also be used to render labels on maps. A layout strategy can be passed to the component in order to arrange the child rectangles avoiding collisions. A filter function can also be applied in order to remove overlaps or post-process the layout.</p>
<p>The <code>size</code> and <code>position</code> of each child can be specified via constants or as accessor functions of the underlying bound data. The rectangles layout component operates in the screen coordinate system, hence these values are both in pixels.</p>
<p>The component has <code>xScale</code> and <code>yScale</code> properties, which are provided as a convenient mechanism for determining the overall bounding box when used in conjunction with a <a href="/components/chart/cartesian.html">cartesian chart</a>.</p>
<p>The following example shows how a number of labels can be arranged by this layout component:</p>
<pre><code class="lang-js"><span class="hljs-built_in">var</span> width = <span class="hljs-number">70</span>, height = <span class="hljs-number">20</span>;

<span class="hljs-comment">// a very simple example component</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">label</span>(<span class="hljs-params">selection</span>) </span>{
    selection.append(<span class="hljs-string">'rect'</span>)
        .layout(<span class="hljs-string">'flex'</span>, <span class="hljs-number">1</span>);
    selection.append(<span class="hljs-string">'text'</span>)
        .text(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.language; })
        .attr({
            <span class="hljs-attribute">x</span>: width / <span class="hljs-number">2</span>, <span class="hljs-attribute">y</span>: height / <span class="hljs-number">2</span>,
            <span class="hljs-attribute">style</span>: <span class="hljs-string">'text-anchor: middle; dominant-baseline: middle'</span>
        });
    selection.layout();
}

<span class="hljs-built_in">var</span> yScale = d3.scale.linear(),
    xScale = d3.scale.linear();

<span class="hljs-built_in">var</span> chart = fc.chart.cartesian(
              xScale,
              yScale)
    .yDomain(fc.util.extent().pad(<span class="hljs-number">0.2</span>).fields(<span class="hljs-string">'users'</span>)(data))
    .xDomain(fc.util.extent().pad(<span class="hljs-number">0.2</span>).fields(<span class="hljs-string">'orgs'</span>)(data))
    .xLabel(<span class="hljs-string">'GitHub Organizations'</span>)
    .yLabel(<span class="hljs-string">'GitHub Users'</span>)
    .chartLabel(<span class="hljs-string">'GitHub User to Organization Ratio'</span>)
    .margin({<span class="hljs-attribute">right</span>: <span class="hljs-number">50</span>, <span class="hljs-attribute">bottom</span>: <span class="hljs-number">50</span>, <span class="hljs-attribute">top</span>: <span class="hljs-number">30</span>})
    .plotArea(multi);

<span class="hljs-comment">// create the layout that positions the labels</span>
<span class="hljs-built_in">var</span> labels = fc.layout.rectangles(fc.layout.strategy.greedy())
        .size([width, height])
        .position(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> [xScale(d.orgs), yScale(d.users)]; })
        .component(label);

<span class="hljs-comment">// render them together with a point series</span>
<span class="hljs-built_in">var</span> points = fc.series.point()
    .xValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.orgs; })
    .yValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.users; });
<span class="hljs-built_in">var</span> multi = fc.series.multi()
        .series([labels, points]);

chart.plotArea(multi);

<span class="hljs-comment">// bind the data and render</span>
d3.select(<span class="hljs-string">'#rectangles-example'</span>)
    .datum(data)
    .call(chart);
</code></pre>
<p>Which is rendered as follows:</p>
<div class="codepen-link">
  <form action="https://codepen.io/pen/define" method="POST" target="_blank">
    <input type="text" name="data" hidden="true"
      value='{
        "html":"&lt;div id&#x3D;\&quot;rectangles-example\&quot; class&#x3D;\&quot;chart large\&quot;&gt;&lt;/div&gt;\n",
        "js": "var data = [\n    {\n        \"language\": \"JavaScript\",\n        \"orgs\": 500,\n        \"users\": 1119\n    },\n    {\n        \"language\": \"Java\",\n        \"orgs\": 240,\n        \"users\": 899\n    },\n    {\n        \"language\": \"Python\",\n        \"orgs\": 151,\n        \"users\": 402\n    },\n    {\n        \"language\": \"Objective-C\",\n        \"orgs\": 99,\n        \"users\": 508\n    },\n    {\n        \"language\": \"Swift\",\n        \"orgs\": 100,\n        \"users\": 383\n    },\n    {\n        \"language\": \"Go\",\n        \"orgs\": 157,\n        \"users\": 248\n    },\n    {\n        \"language\": \"PHP\",\n        \"orgs\": 96,\n        \"users\": 137\n    },\n    {\n        \"language\": \"HTML\",\n        \"orgs\": 70,\n        \"users\": 124\n    },\n    {\n        \"language\": \"CSS\",\n        \"orgs\": 63,\n        \"users\": 132\n    },\n    {\n        \"language\": \"Ruby\",\n        \"orgs\": 67,\n        \"users\": 96\n    },\n    {\n        \"language\": \"C++\",\n        \"orgs\": 124,\n        \"users\": 107\n    },\n    {\n        \"language\": \"C\",\n        \"orgs\": 76,\n        \"users\": 136\n    },\n    {\n        \"language\": \"C#\",\n        \"orgs\": 78,\n        \"users\": 64\n    },\n    {\n        \"language\": \"Shell\",\n        \"orgs\": 36,\n        \"users\": 94\n    },\n    {\n        \"language\": \"Scala\",\n        \"orgs\": 23,\n        \"users\": 25\n    },\n    {\n        \"language\": \"Clojure\",\n        \"orgs\": 9,\n        \"users\": 24\n    },\n    {\n        \"language\": \"Haskell\",\n        \"orgs\": 8,\n        \"users\": 16\n    },\n    {\n        \"language\": \"CoffeeScript\",\n        \"orgs\": 11,\n        \"users\": 21\n    },\n    {\n        \"language\": \"Lua\",\n        \"orgs\": 10,\n        \"users\": 19\n    },\n    {\n        \"language\": \"R\",\n        \"orgs\": 1,\n        \"users\": 6\n    },\n    {\n        \"language\": \"VimL\",\n        \"orgs\": 4,\n        \"users\": 20\n    },\n    {\n        \"language\": \"Perl\",\n        \"orgs\": 1,\n        \"users\": 5\n    }\n];\n\n//START\nvar width = 70, height = 20;\n\n// a very simple example component\nfunction label(selection) {\n    selection.append(\"rect\")\n        .layout(\"flex\", 1);\n    selection.append(\"text\")\n        .text(function(d) { return d.language; })\n        .attr({\n            x: width / 2, y: height / 2,\n            style: \"text-anchor: middle; dominant-baseline: middle\"\n        });\n    selection.layout();\n}\n\nvar yScale = d3.scale.linear(),\n    xScale = d3.scale.linear();\n\nvar chart = fc.chart.cartesian(\n              xScale,\n              yScale)\n    .yDomain(fc.util.extent().pad(0.2).fields(\"users\")(data))\n    .xDomain(fc.util.extent().pad(0.2).fields(\"orgs\")(data))\n    .xLabel(\"GitHub Organizations\")\n    .yLabel(\"GitHub Users\")\n    .chartLabel(\"GitHub User to Organization Ratio\")\n    .margin({right: 50, bottom: 50, top: 30})\n    .plotArea(multi);\n\n// create the layout that positions the labels\nvar labels = fc.layout.rectangles(fc.layout.strategy.greedy())\n        .size([width, height])\n        .position(function(d) { return [xScale(d.orgs), yScale(d.users)]; })\n        .component(label);\n\n// render them together with a point series\nvar points = fc.series.point()\n    .xValue(function(d) { return d.orgs; })\n    .yValue(function(d) { return d.users; });\nvar multi = fc.series.multi()\n        .series([labels, points]);\n\nchart.plotArea(multi);\n\n// bind the data and render\nd3.select(\"#rectangles-example\")\n    .datum(data)\n    .call(chart);\n//END\n",
        "css": ".chart {\n    margin: 10px 0;\n    width: 100%;\n    height: 250px;\n}\n\n.chart&gt;svg {\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.chart.large {\n    height: 400px;\n}\n#rectangles-example .rectangle rect {\n    fill: rgba(0,255,0,0.3);\n    stroke-width: 0;\n}\n\n\n#rectangles-measure .rectangle rect {\n    fill: transparent;\n    stroke-width: 0;\n}\n\n.chart .title .label {\n    font-size: 16pt;\n}\n\n.chart .label {\n    font-size: 12pt;\n}\n",
        "js_external": "https://d3fc.io/d3fc.bundle.js",
        "css_external": "https://d3fc.io/d3fc.css"}
      '/>
    <input type="submit" class="btn btn-default" value="Codepen"/>
  </form>
</div>


<style>
#rectangles-example .rectangle rect {
    fill: rgba(0,255,0,0.3);
    stroke-width: 0;
}


#rectangles-measure .rectangle rect {
    fill: transparent;
    stroke-width: 0;
}

.chart .title .label {
    font-size: 16pt;
}

.chart .label {
    font-size: 12pt;
}

</style>

<div id="rectangles-example" class='chart large'></div>

<script type="text/javascript">
var data = [
    {
        'language': 'JavaScript',
        'orgs': 500,
        'users': 1119
    },
    {
        'language': 'Java',
        'orgs': 240,
        'users': 899
    },
    {
        'language': 'Python',
        'orgs': 151,
        'users': 402
    },
    {
        'language': 'Objective-C',
        'orgs': 99,
        'users': 508
    },
    {
        'language': 'Swift',
        'orgs': 100,
        'users': 383
    },
    {
        'language': 'Go',
        'orgs': 157,
        'users': 248
    },
    {
        'language': 'PHP',
        'orgs': 96,
        'users': 137
    },
    {
        'language': 'HTML',
        'orgs': 70,
        'users': 124
    },
    {
        'language': 'CSS',
        'orgs': 63,
        'users': 132
    },
    {
        'language': 'Ruby',
        'orgs': 67,
        'users': 96
    },
    {
        'language': 'C++',
        'orgs': 124,
        'users': 107
    },
    {
        'language': 'C',
        'orgs': 76,
        'users': 136
    },
    {
        'language': 'C#',
        'orgs': 78,
        'users': 64
    },
    {
        'language': 'Shell',
        'orgs': 36,
        'users': 94
    },
    {
        'language': 'Scala',
        'orgs': 23,
        'users': 25
    },
    {
        'language': 'Clojure',
        'orgs': 9,
        'users': 24
    },
    {
        'language': 'Haskell',
        'orgs': 8,
        'users': 16
    },
    {
        'language': 'CoffeeScript',
        'orgs': 11,
        'users': 21
    },
    {
        'language': 'Lua',
        'orgs': 10,
        'users': 19
    },
    {
        'language': 'R',
        'orgs': 1,
        'users': 6
    },
    {
        'language': 'VimL',
        'orgs': 4,
        'users': 20
    },
    {
        'language': 'Perl',
        'orgs': 1,
        'users': 5
    }
];

//START
var width = 70, height = 20;

// a very simple example component
function label(selection) {
    selection.append('rect')
        .layout('flex', 1);
    selection.append('text')
        .text(function(d) { return d.language; })
        .attr({
            x: width / 2, y: height / 2,
            style: 'text-anchor: middle; dominant-baseline: middle'
        });
    selection.layout();
}

var yScale = d3.scale.linear(),
    xScale = d3.scale.linear();

var chart = fc.chart.cartesian(
              xScale,
              yScale)
    .yDomain(fc.util.extent().pad(0.2).fields('users')(data))
    .xDomain(fc.util.extent().pad(0.2).fields('orgs')(data))
    .xLabel('GitHub Organizations')
    .yLabel('GitHub Users')
    .chartLabel('GitHub User to Organization Ratio')
    .margin({right: 50, bottom: 50, top: 30})
    .plotArea(multi);

// create the layout that positions the labels
var labels = fc.layout.rectangles(fc.layout.strategy.greedy())
        .size([width, height])
        .position(function(d) { return [xScale(d.orgs), yScale(d.users)]; })
        .component(label);

// render them together with a point series
var points = fc.series.point()
    .xValue(function(d) { return d.orgs; })
    .yValue(function(d) { return d.users; });
var multi = fc.series.multi()
        .series([labels, points]);

chart.plotArea(multi);

// bind the data and render
d3.select('#rectangles-example')
    .datum(data)
    .call(chart);
//END

</script>

<p>NOTE: The rectangles layout component sets the <code>layout-width</code> and <code>layout-height</code> attributes of the generated child component containers, this allows the child component to use <a href="/components/layout/flexbox.html">flexbox layout</a>.</p>
<p>In the above example the width and height of each rectangle is hard coded, which is not ideal for text labels. The following example measures bounding box for each item of text so that its rectangular container tightly &#39;hugs&#39; the text.</p>
<p>This example also makes use of the <code>fc.layout.strategy.removeOverlaps</code> strategy that is applied as a <code>filter</code> in order to cull labels that overlap:</p>
<pre><code class="lang-js"><span class="hljs-comment">// measure the dimension of the given text</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boundingBox</span>(<span class="hljs-params">textToMeasure</span>) </span>{
    <span class="hljs-built_in">var</span> svg = d3.select(<span class="hljs-string">'body'</span>).append(<span class="hljs-string">'svg'</span>)
        .attr(<span class="hljs-string">'width'</span>, <span class="hljs-number">1000</span>)
        .attr(<span class="hljs-string">'height'</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-built_in">var</span> text = svg.append(<span class="hljs-string">'text'</span>)
        .text(textToMeasure);
    <span class="hljs-built_in">var</span> bbox = text[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>].getBBox();
    svg.remove();
    <span class="hljs-keyword">return</span> [bbox.width, bbox.height];
}

<span class="hljs-comment">// a very simple example component</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">label</span>(<span class="hljs-params">selection</span>) </span>{
    selection.append(<span class="hljs-string">'rect'</span>)
            .layout(<span class="hljs-string">'flex'</span>, <span class="hljs-number">1</span>);
    selection.append(<span class="hljs-string">'text'</span>)
            .text(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.language; })
            .layout({
                <span class="hljs-attribute">position</span>: <span class="hljs-string">'absolute'</span>,
                <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>
            })
            .attr({
                <span class="hljs-comment">// vertically centre the text in the container</span>
                <span class="hljs-string">'dominant-baseline'</span>: <span class="hljs-string">'middle'</span>,
                <span class="hljs-string">'dy'</span>: <span class="hljs-string">'-0.5em'</span>
            });
    selection.layout();
}

<span class="hljs-built_in">var</span> yScale = d3.scale.linear(),
    xScale = d3.scale.linear();

<span class="hljs-built_in">var</span> chart = fc.chart.cartesian(
              xScale,
              yScale)
    .yDomain(fc.util.extent().pad(<span class="hljs-number">0.2</span>).fields(<span class="hljs-string">'users'</span>)(data))
    .xDomain(fc.util.extent().pad(<span class="hljs-number">0.2</span>).fields(<span class="hljs-string">'orgs'</span>)(data))
    .xLabel(<span class="hljs-string">'GitHub Organizations'</span>)
    .yLabel(<span class="hljs-string">'GitHub Users'</span>)
    .chartLabel(<span class="hljs-string">'GitHub User to Organization Ratio'</span>)
    .margin({<span class="hljs-attribute">right</span>: <span class="hljs-number">50</span>, <span class="hljs-attribute">bottom</span>: <span class="hljs-number">50</span>, <span class="hljs-attribute">top</span>: <span class="hljs-number">30</span>})
    .plotArea(multi);

<span class="hljs-comment">// create the layout that positions the labels</span>
<span class="hljs-built_in">var</span> labels = fc.layout.rectangles(fc.layout.strategy.greedy())
        .size(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> boundingBox(d.language); })
        .position(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> [xScale(d.orgs), yScale(d.users)]; })
        .filter(fc.layout.strategy.removeOverlaps())
        .component(label);

<span class="hljs-comment">// render them together with a point series</span>
<span class="hljs-built_in">var</span> points = fc.series.point()
    .size(<span class="hljs-number">12</span>)
    .xValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.orgs; })
    .yValue(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.users; });
<span class="hljs-built_in">var</span> multi = fc.series.multi()
        .series([labels, points]);

chart.plotArea(multi);

<span class="hljs-comment">// bind the data and render</span>
d3.select(<span class="hljs-string">'#rectangles-measure'</span>)
    .datum(data)
    .call(chart);
</code></pre>
<div class="codepen-link">
  <form action="https://codepen.io/pen/define" method="POST" target="_blank">
    <input type="text" name="data" hidden="true"
      value='{
        "html":"&lt;div id&#x3D;\&quot;rectangles-measure\&quot; class&#x3D;\&quot;chart large\&quot;&gt;&lt;/div&gt;\n",
        "js": "var data = [\n    {\n        \"language\": \"JavaScript\",\n        \"orgs\": 500,\n        \"users\": 1119\n    },\n    {\n        \"language\": \"Java\",\n        \"orgs\": 240,\n        \"users\": 899\n    },\n    {\n        \"language\": \"Python\",\n        \"orgs\": 151,\n        \"users\": 402\n    },\n    {\n        \"language\": \"Objective-C\",\n        \"orgs\": 99,\n        \"users\": 508\n    },\n    {\n        \"language\": \"Swift\",\n        \"orgs\": 100,\n        \"users\": 383\n    },\n    {\n        \"language\": \"Go\",\n        \"orgs\": 157,\n        \"users\": 248\n    },\n    {\n        \"language\": \"PHP\",\n        \"orgs\": 96,\n        \"users\": 137\n    },\n    {\n        \"language\": \"HTML\",\n        \"orgs\": 70,\n        \"users\": 124\n    },\n    {\n        \"language\": \"CSS\",\n        \"orgs\": 63,\n        \"users\": 132\n    },\n    {\n        \"language\": \"Ruby\",\n        \"orgs\": 67,\n        \"users\": 96\n    },\n    {\n        \"language\": \"C++\",\n        \"orgs\": 124,\n        \"users\": 107\n    },\n    {\n        \"language\": \"C\",\n        \"orgs\": 76,\n        \"users\": 136\n    },\n    {\n        \"language\": \"C#\",\n        \"orgs\": 78,\n        \"users\": 64\n    },\n    {\n        \"language\": \"Shell\",\n        \"orgs\": 36,\n        \"users\": 94\n    },\n    {\n        \"language\": \"Scala\",\n        \"orgs\": 23,\n        \"users\": 25\n    },\n    {\n        \"language\": \"Clojure\",\n        \"orgs\": 9,\n        \"users\": 24\n    },\n    {\n        \"language\": \"Haskell\",\n        \"orgs\": 8,\n        \"users\": 16\n    },\n    {\n        \"language\": \"CoffeeScript\",\n        \"orgs\": 11,\n        \"users\": 21\n    },\n    {\n        \"language\": \"Lua\",\n        \"orgs\": 10,\n        \"users\": 19\n    },\n    {\n        \"language\": \"R\",\n        \"orgs\": 1,\n        \"users\": 6\n    },\n    {\n        \"language\": \"VimL\",\n        \"orgs\": 4,\n        \"users\": 20\n    },\n    {\n        \"language\": \"Perl\",\n        \"orgs\": 1,\n        \"users\": 5\n    }\n];\n\n//START\n// measure the dimension of the given text\nfunction boundingBox(textToMeasure) {\n    var svg = d3.select(\"body\").append(\"svg\")\n        .attr(\"width\", 1000)\n        .attr(\"height\", 1000);\n    var text = svg.append(\"text\")\n        .text(textToMeasure);\n    var bbox = text[0][0].getBBox();\n    svg.remove();\n    return [bbox.width, bbox.height];\n}\n\n// a very simple example component\nfunction label(selection) {\n    selection.append(\"rect\")\n            .layout(\"flex\", 1);\n    selection.append(\"text\")\n            .text(function(d) { return d.language; })\n            .layout({\n                position: \"absolute\",\n                bottom: 0\n            })\n            .attr({\n                // vertically centre the text in the container\n                \"dominant-baseline\": \"middle\",\n                \"dy\": \"-0.5em\"\n            });\n    selection.layout();\n}\n\nvar yScale = d3.scale.linear(),\n    xScale = d3.scale.linear();\n\nvar chart = fc.chart.cartesian(\n              xScale,\n              yScale)\n    .yDomain(fc.util.extent().pad(0.2).fields(\"users\")(data))\n    .xDomain(fc.util.extent().pad(0.2).fields(\"orgs\")(data))\n    .xLabel(\"GitHub Organizations\")\n    .yLabel(\"GitHub Users\")\n    .chartLabel(\"GitHub User to Organization Ratio\")\n    .margin({right: 50, bottom: 50, top: 30})\n    .plotArea(multi);\n\n// create the layout that positions the labels\nvar labels = fc.layout.rectangles(fc.layout.strategy.greedy())\n        .size(function(d) { return boundingBox(d.language); })\n        .position(function(d) { return [xScale(d.orgs), yScale(d.users)]; })\n        .filter(fc.layout.strategy.removeOverlaps())\n        .component(label);\n\n// render them together with a point series\nvar points = fc.series.point()\n    .size(12)\n    .xValue(function(d) { return d.orgs; })\n    .yValue(function(d) { return d.users; });\nvar multi = fc.series.multi()\n        .series([labels, points]);\n\nchart.plotArea(multi);\n\n// bind the data and render\nd3.select(\"#rectangles-measure\")\n    .datum(data)\n    .call(chart);\n//END\n",
        "css": ".chart {\n    margin: 10px 0;\n    width: 100%;\n    height: 250px;\n}\n\n.chart&gt;svg {\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.chart.large {\n    height: 400px;\n}\n#rectangles-example .rectangle rect {\n    fill: rgba(0,255,0,0.3);\n    stroke-width: 0;\n}\n\n\n#rectangles-measure .rectangle rect {\n    fill: transparent;\n    stroke-width: 0;\n}\n\n.chart .title .label {\n    font-size: 16pt;\n}\n\n.chart .label {\n    font-size: 12pt;\n}\n",
        "js_external": "https://d3fc.io/d3fc.bundle.js",
        "css_external": "https://d3fc.io/d3fc.css"}
      '/>
    <input type="submit" class="btn btn-default" value="Codepen"/>
  </form>
</div>


<div id="rectangles-measure" class='chart large'></div>

<script type="text/javascript">
var data = [
    {
        'language': 'JavaScript',
        'orgs': 500,
        'users': 1119
    },
    {
        'language': 'Java',
        'orgs': 240,
        'users': 899
    },
    {
        'language': 'Python',
        'orgs': 151,
        'users': 402
    },
    {
        'language': 'Objective-C',
        'orgs': 99,
        'users': 508
    },
    {
        'language': 'Swift',
        'orgs': 100,
        'users': 383
    },
    {
        'language': 'Go',
        'orgs': 157,
        'users': 248
    },
    {
        'language': 'PHP',
        'orgs': 96,
        'users': 137
    },
    {
        'language': 'HTML',
        'orgs': 70,
        'users': 124
    },
    {
        'language': 'CSS',
        'orgs': 63,
        'users': 132
    },
    {
        'language': 'Ruby',
        'orgs': 67,
        'users': 96
    },
    {
        'language': 'C++',
        'orgs': 124,
        'users': 107
    },
    {
        'language': 'C',
        'orgs': 76,
        'users': 136
    },
    {
        'language': 'C#',
        'orgs': 78,
        'users': 64
    },
    {
        'language': 'Shell',
        'orgs': 36,
        'users': 94
    },
    {
        'language': 'Scala',
        'orgs': 23,
        'users': 25
    },
    {
        'language': 'Clojure',
        'orgs': 9,
        'users': 24
    },
    {
        'language': 'Haskell',
        'orgs': 8,
        'users': 16
    },
    {
        'language': 'CoffeeScript',
        'orgs': 11,
        'users': 21
    },
    {
        'language': 'Lua',
        'orgs': 10,
        'users': 19
    },
    {
        'language': 'R',
        'orgs': 1,
        'users': 6
    },
    {
        'language': 'VimL',
        'orgs': 4,
        'users': 20
    },
    {
        'language': 'Perl',
        'orgs': 1,
        'users': 5
    }
];

//START
// measure the dimension of the given text
function boundingBox(textToMeasure) {
    var svg = d3.select('body').append('svg')
        .attr('width', 1000)
        .attr('height', 1000);
    var text = svg.append('text')
        .text(textToMeasure);
    var bbox = text[0][0].getBBox();
    svg.remove();
    return [bbox.width, bbox.height];
}

// a very simple example component
function label(selection) {
    selection.append('rect')
            .layout('flex', 1);
    selection.append('text')
            .text(function(d) { return d.language; })
            .layout({
                position: 'absolute',
                bottom: 0
            })
            .attr({
                // vertically centre the text in the container
                'dominant-baseline': 'middle',
                'dy': '-0.5em'
            });
    selection.layout();
}

var yScale = d3.scale.linear(),
    xScale = d3.scale.linear();

var chart = fc.chart.cartesian(
              xScale,
              yScale)
    .yDomain(fc.util.extent().pad(0.2).fields('users')(data))
    .xDomain(fc.util.extent().pad(0.2).fields('orgs')(data))
    .xLabel('GitHub Organizations')
    .yLabel('GitHub Users')
    .chartLabel('GitHub User to Organization Ratio')
    .margin({right: 50, bottom: 50, top: 30})
    .plotArea(multi);

// create the layout that positions the labels
var labels = fc.layout.rectangles(fc.layout.strategy.greedy())
        .size(function(d) { return boundingBox(d.language); })
        .position(function(d) { return [xScale(d.orgs), yScale(d.users)]; })
        .filter(fc.layout.strategy.removeOverlaps())
        .component(label);

// render them together with a point series
var points = fc.series.point()
    .size(12)
    .xValue(function(d) { return d.orgs; })
    .yValue(function(d) { return d.users; });
var multi = fc.series.multi()
        .series([labels, points]);

chart.plotArea(multi);

// bind the data and render
d3.select('#rectangles-measure')
    .datum(data)
    .call(chart);
//END

</script>

<p>There are a number of strategies that can be used to resolve overlaps, these include:</p>
<ul>
<li><code>greedy</code> - The greedy strategy adds each rectangle in sequence, selecting the position where the rectangle has the lowest overlap with already added rectangles and is inside the container.</li>
<li><code>annealing</code> - The simulated annealing layout strategy runs over a set number of iterations, choosing a different location for one rectangle on each iteration. If that location results in a better result, it is saved for the next iteration. Otherwise, it is saved with probability inversely proportional with the iteration it is currently on. This helps it break out of local optimums, hopefully producing better output. Because of the random nature of the algorithm, it produces variable output. The <code>temperature</code> parameter indicates the initial &#39;number&#39; to use for the random probability calculation, and <code>cooling</code> defines the delta of the temperature between iterations. The algorithm runs for <code>Math.ceil(temperature / cooling)</code> iterations.</li>
<li><code>boundingBox</code>- The bounding box layout strategy moves a rectangle if it leaves the container. It does no overlap correction.</li>
<li><code>local</code> - The local search layout strategy tries to resolve rectangle overlaps. It attempts to move each rectangle with an overlap to another potential placement with a better overlap.</li>
</ul>


      <nav class="visible-xs-block">
        <ul class="pager">
            <li class="previous"><a href="/components/layout/flexbox.html"><span aria-hidden="true">&larr;</span> Flexbox</a></li>
            <li class="next"><a href="/components/sampler/largestTriangleOne.html">Largest Triangle 1 Bucket <span aria-hidden="true">&rarr;</span></a></li>
        </ul>
      </nav>
    </div>

    <nav class="col-sm-3 hidden-xs">
      <ul class="nav nav-stacked fixed nav-sidebar">
          <li>
            <h4>Chart</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/chart/cartesian.html">
                    Cartesian
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/legend.html">
                    Legend
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/small-multiples.html">
                    Small Multiples
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/sparkline.html">
                    Sparkline
                  </a>
                </li>
                <li class="">
                  <a href="/components/chart/tooltip.html">
                    Tooltip
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Series</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/series/area.html">
                    Area Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/bar.html">
                    Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/boxPlot.html">
                    Box Plot Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/cycle.html">
                    Cycle Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/errorBar.html">
                    Error Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/grouped-bar.html">
                    Grouped Bar Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/line.html">
                    Line Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/multi.html">
                    Multi Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/point.html">
                    Point Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/stacked.html">
                    Stacked Series
                  </a>
                </li>
                <li class="">
                  <a href="/components/series/waterfall.html">
                    Waterfall Series
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Annotation</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/annotation/band.html">
                    Band
                  </a>
                </li>
                <li class="">
                  <a href="/components/annotation/gridlines.html">
                    Gridlines
                  </a>
                </li>
                <li class="">
                  <a href="/components/annotation/line.html">
                    Line
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Data</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/data/spread.html">
                    Spread
                  </a>
                </li>
                <li class="">
                  <a href="/components/data/walk.html">
                    Random Walk
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Layout</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/layout/flexbox.html">
                    Flexbox
                  </a>
                </li>
                <li class="active">
                  <a href="/components/layout/rectangles.html">
                    Rectangles
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Samplers</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/sampler/largestTriangleOne.html">
                    Largest Triangle 1 Bucket
                  </a>
                </li>
                <li class="">
                  <a href="/components/sampler/largestTriangleThreeBucket.html">
                    Largest Triangle 3 Buckets
                  </a>
                </li>
                <li class="">
                  <a href="/components/sampler/modeMedian.html">
                    Mode Median
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Scale</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/scale/dateTime.html">
                    Date Time Scale
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>SVG</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/svg/axis.html">
                    Axis
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Tool</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/tool/container.html">
                    Container
                  </a>
                </li>
                <li class="">
                  <a href="/components/tool/crosshair.html">
                    Crosshair
                  </a>
                </li>
            </ul>
          </li>
          <li>
            <h4>Util</h4>
            <ul class="nav nav-stacked">
                <li class="">
                  <a href="/components/util/extent.html">
                    Extent
                  </a>
                </li>
            </ul>
          </li>
      </ul>
    </nav>

  </div>
</div>


    </div>
    <footer>
      <div class="container">
        <p class="muted credit text-center">Project supported by <a href="http://www.scottlogic.com">Scott Logic</a>.</p>
        <p class="muted credit text-center">Browser testing provided by <a class="browserstack" href="https://browserstack.com">BrowserStack</a>.</p>
      </div>
    </footer>

  </body>
</html>
